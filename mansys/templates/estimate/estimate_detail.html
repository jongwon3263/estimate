{% extends "base.html" %}
{% block content %}
<div class="container my-3">
    <h2>견적서 상세</h2>

    <table class="table table-bordered">
        <tbody>
            <tr><th>ID</th><td>{{ estimate.id }}</td></tr>
            <tr><th>고객명</th><td>{{ estimate.customer_name }}</td></tr>
            <tr><th>연락처</th><td>{{ estimate.customer_phone }}</td></tr>
            <tr><th>주소</th><td>{{ estimate.address }}</td></tr>
            <tr><th>집 구조</th><td>{{ estimate.room_type }}</td></tr>

            {# 일반평수, 소형평수일때 각각 표시 #}
            {% if estimate.room_type == 'normalType' %}
            <tr><th>평수</th><td>{{ estimate.pyeong or '' }}</td></tr>
            {% elif estimate.room_type == 'smallType' %}
            <tr><th>소형 평수 구조</th><td>{{ estimate.small_room_type or '' }}</td></tr>
            {% endif %}

            <tr><th>작성일</th><td>{{ estimate.created_at.strftime('%Y-%m-%d %H:%M') }}</td></tr>
            <tr><th>견적 상태</th><td>{{ estimate.status }}</td></tr>
            
            {# 할인 전 금액(estimate_items의 price들을 합침) #}
            {% set total_before_discount = estimate.items | sum(attribute='price') %}
            <tr>
                <th>할인 전 금액</th>
                <td>{{ "{:,}".format(total_before_discount or 0) }}원</td>
            </tr>

            <tr><th>할인1 (청소+새집증후군)</th><td>-{{ "{:,}".format(estimate.discount1 or 0) }}원</td></tr>
            <tr><th>할인2 (다다익선)</th><td>-{{ "{:,}".format(estimate.discount2 or 0) }}원</td></tr>
            <tr><th>할인3 (직접입력)</th><td>-{{ "{:,}".format(estimate.discount3 or 0) }}원</td></tr>
            <tr><th>최종 합계</th><td><strong>{{ "{:,}".format(estimate.total_price or 0) }}원</strong></td></tr>
        </tbody>
    </table>

    <h4 class="mt-4">서비스 항목</h4>
    <table class="table table-striped table-sm">
        <thead>
            <tr>
                <th>서비스</th>
                <th>카테고리</th>
                <th>옵션</th>
                <th>가격</th>
                <th>시작일</th>
                <th>종료일</th>
            </tr>
        </thead>
        <tbody>
            {% for item in estimate.items %}
            <tr>
                <td>{{ item.service_id }}</td>
                <td>{{ item.category_code }}</td>
                <td>{{ item.option_code }}</td>
                <td>{{ "{:,}".format(item.price or 0) }}원</td>
                <td>{{ item.start_date or '' }}</td>
                <td>{{ item.end_date or '' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <a href="{{ url_for('estimate.estimate_list') }}" class="btn btn-secondary mt-3">목록으로</a>
</div>
{% endblock %}